<!DOCTYPE html>
<html>
<head>
    <title>React App Debug Test</title>
</head>
<body>
    <h1>React App Debug Test</h1>
    <button onclick="testEnvironmentConfig()">Test Environment Config</button>
    <button onclick="testAxiosConfig()">Test Axios Config</button>
    <button onclick="testDirectLogin()">Test Direct Login</button>
    <div id="results"></div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        // Simulate the configHelpers.jsx logic
        function getApiUrl() {
            // Check VITE_API_URL (this would normally come from import.meta.env)
            const VITE_API_URL = 'http://localhost:5000'; // From .env file
            if (VITE_API_URL) {
                console.log('üîß Using VITE_API_URL:', VITE_API_URL);
                return VITE_API_URL;
            }
            
            const fallbackUrl = 'http://localhost:5000';
            console.log('üîß Using fallback URL:', fallbackUrl);
            return fallbackUrl;
        }

        // Create axios instance like in configHelpers.jsx
        const apiUrl = getApiUrl();
        const axiosInstance = axios.create({
            baseURL: apiUrl,
            timeout: 10000,
            headers: {
                'Content-Type': 'application/json',
            },
        });

        console.log('üì° Axios configured with baseURL:', axiosInstance.defaults.baseURL);

        function testEnvironmentConfig() {
            const resultsDiv = document.getElementById('results');
            const apiUrl = getApiUrl();
            resultsDiv.innerHTML = `
                <h3>Environment Configuration Test:</h3>
                <p>API URL: ${apiUrl}</p>
                <p>Axios Base URL: ${axiosInstance.defaults.baseURL}</p>
                <p>Timeout: ${axiosInstance.defaults.timeout}ms</p>
            `;
        }

        async function testAxiosConfig() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Testing Axios configuration...';
            
            try {
                // Just test a simple GET request to check connectivity
                const response = await axiosInstance.get('/api/users/health', {
                    timeout: 5000  // Shorter timeout for this test
                });
                
                resultsDiv.innerHTML = `
                    <h3>Axios Configuration Test:</h3>
                    <p>‚úÖ Connection successful!</p>
                    <p>Status: ${response.status}</p>
                    <p>Base URL used: ${axiosInstance.defaults.baseURL}</p>
                `;
                console.log('Axios test successful:', response.status);
            } catch (error) {
                if (error.code === 'ECONNABORTED') {
                    resultsDiv.innerHTML = `
                        <h3>Axios Configuration Test:</h3>
                        <p>‚ùå Timeout Error: ${error.message}</p>
                        <p>This indicates the request is taking too long</p>
                        <p>Base URL attempted: ${axiosInstance.defaults.baseURL}</p>
                    `;
                } else if (error.response) {
                    resultsDiv.innerHTML = `
                        <h3>Axios Configuration Test:</h3>
                        <p>üì§ Server Response: ${error.response.status}</p>
                        <p>Data: ${JSON.stringify(error.response.data)}</p>
                        <p>Base URL used: ${axiosInstance.defaults.baseURL}</p>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <h3>Axios Configuration Test:</h3>
                        <p>üî• Network Error: ${error.message}</p>
                        <p>This could indicate CORS or connectivity issues</p>
                        <p>Base URL attempted: ${axiosInstance.defaults.baseURL}</p>
                    `;
                }
                console.error('Axios test error:', error);
            }
        }

        async function testDirectLogin() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Testing login endpoint...';
            
            try {
                console.log('üöÄ Starting login test with baseURL:', axiosInstance.defaults.baseURL);
                const response = await axiosInstance.post('/api/users/login', {
                    email: 'test@example.com',
                    password: 'test123'
                });
                
                resultsDiv.innerHTML = `
                    <h3>Login Test Result:</h3>
                    <p>‚úÖ Request completed!</p>
                    <p>Status: ${response.status}</p>
                    <p>Data: ${JSON.stringify(response.data, null, 2)}</p>
                `;
                console.log('Login test response:', response.status, response.data);
            } catch (error) {
                if (error.code === 'ECONNABORTED') {
                    resultsDiv.innerHTML = `
                        <h3>Login Test Result:</h3>
                        <p>‚ùå TIMEOUT ERROR: ${error.message}</p>
                        <p>Request took longer than ${axiosInstance.defaults.timeout}ms</p>
                        <p>URL attempted: ${axiosInstance.defaults.baseURL}/api/users/login</p>
                        <p><strong>This is the same error you're seeing in the React app!</strong></p>
                    `;
                } else if (error.response) {
                    resultsDiv.innerHTML = `
                        <h3>Login Test Result:</h3>
                        <p>üì§ Server responded with: ${error.response.status}</p>
                        <p>Data: ${JSON.stringify(error.response.data, null, 2)}</p>
                        <p>‚úÖ This means the connection is working!</p>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <h3>Login Test Result:</h3>
                        <p>üî• Network Error: ${error.message}</p>
                        <p>URL attempted: ${axiosInstance.defaults.baseURL}/api/users/login</p>
                    `;
                }
                console.error('Login test error:', error);
            }
        }
    </script>
</body>
</html>
